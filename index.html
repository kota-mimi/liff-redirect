<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>LIFF Redirect</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
<script>
(async () => {
  // ===== 設定ここだけ =====
  const LIFF_ID = "2007900002-JdARGprl"; // ← あなたのLIFF ID
  const GAS_URL = "YOUR_GAS_EXEC_URL";   // ← あなたのGAS exec URL
  // ========================

  const showError = (msg) => {
    document.body.innerHTML =
      '<pre style="white-space:pre-wrap;word-break:break-all;">' + msg + '</pre>';
  };

  try {
    await liff.init({ liffId: LIFF_ID });

    // 未ログインの人だけログイン画面へ
    if (!liff.isLoggedIn()) {
      liff.login();
      return;
    }

    await liff.ready;

    // userId取得
    const profile = await liff.getProfile();
    const userId = profile.userId;

    if (!userId) {
      showError("userIdを取得できませんでした。LINEアプリ内でBot連携して開いてください。");
      return;
    }

    // GASへ転送（キャッシュ防止用tパラメータ付き）
    const targetUrl = `${GAS_URL}?userId=${encodeURIComponent(userId)}&t=${Date.now()}`;
    location.replace(targetUrl);

  } catch (e) {
    showError((e && e.message) ? e.message : String(e));
  }
})();
</script>
</body>
</html>
