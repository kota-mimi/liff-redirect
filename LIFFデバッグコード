<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>LIFF Debug</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { font-family: sans-serif; padding: 20px; word-break: break-all; }
      .container { border: 2px solid #f00; padding: 15px; border-radius: 8px; }
      p { margin: 10px 0; }
      strong { color: #f00; }
    </style>
  </head>
  <body>
    <!-- ↓↓↓ この部分にデバッグ情報を表示します ↓↓↓ -->
    <div class="container">
      <h1>デバッグ情報</h1>
      <p>もしこの画面が表示され続けたら、以下の情報を教えてください。</p>
      <hr>
      <p>取得したユーザーID:<br><strong><span id="userId">取得中...</span></strong></p>
      <p>リダイレクト先URL:<br><strong><span id="redirectUrl">取得中...</span></strong></p>
      <hr>
      <p id="timer">5秒後にリダイレクトします...</p>
    </div>

    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
      async function main() {
        try {
          await liff.init({ liffId: "2007869731-n8M4KLmk" });
        } catch (err) {
          document.querySelector('.container').innerHTML = `<h1>LIFF初期化エラー</h1><p>${err.message}</p>`;
          return;
        }

        if (!liff.isLoggedIn()) {
          liff.login({ redirectUri: window.location.href });
          return;
        }

        try {
          const profile = await liff.getProfile();
          const userId = profile.userId;
          const gasUrl = `https://script.google.com/macros/s/AKfycbyNdpFFQ31wKEsbQawdYlIgyaYyu6VhDROCqcWWJyE0xXtwlBqPGfmPs1cp06BP5UY8kA/exec`;
          const redirectUrl = `${gasUrl}?userId=${encodeURIComponent(userId)}`;

          // --- 画面に情報を表示 ---
          document.getElementById('userId').textContent = userId;
          document.getElementById('redirectUrl').textContent = redirectUrl;

          // --- 5秒後にリダイレクト ---
          setTimeout(() => {
            document.getElementById('timer').textContent = "リダイレクトします！";
            window.location.href = redirectUrl;
          }, 5000);

        } catch (err) {
          document.querySelector('.container').innerHTML = `<h1>プロフィール取得エラー</h1><p>${err.message}</p>`;
        }
      }

      main();
    </script>
  </body>
</html>
